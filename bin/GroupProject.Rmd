---
title: "Statistical Inference W4702 Final Project"
author: "Christopher Rusnak, Alimu Mijiti, Christine Lee, Maura Fitzgerald"
date: "December 15, 2015"
output: 
  pdf_document:
    toc: yes
---

```{r knitr_options, include=FALSE}
package_list <- c("knitr","ggplot2","RTextTools",
                  "leaflet","maps","data.table",
                  "dplyr","ggmap","reshape2",
                  "MASS","rpart","glmnet","gam","sp",
                  "rgdal","rgeos","ggthemes","maptools")
for(i in 1:length(package_list)){
  if(!(package_list[i] %in% installed.packages())){
    install.packages(package_list[i])
  } 
}

library(knitr)
library(ggplot2)
library(RTextTools)
library(leaflet)
library(maps)
library(data.table)
library(dplyr)
library(ggmap)
library(reshape2)
library(MASS)
library(rpart)
library(glmnet)
library(gam)
library(sp)
library(rgdal)
library(rgeos)
library(ggthemes)
library(maptools)
opts_chunk$set(tidy.opts=list(width.cutoff=50))
```

## Introduction

### Introduction to our project - Why bother to look at airbnb data?

**Motivation behind studying airbnb data**

In recent years, we come across discussions in the media and
in our communities of how the use of various sharing economy platforms such as Uber and Airbnb have become more prevalent and might have positive or possibly less positive impact on how we operate our
lives.

We ourselves may be avid users of some of these platforms. For example, as a potential guest or owner of an Airbnb listing, one might be interested in determining whether listing prices are fair given the property, and in particular, what variables might be the most meaningful predictors of listing price? If you are an airbnb host, you might wonder which variables can be the best predictors of whether you achieve the "superhost" status?

** Data set requirements**

Further, we had in mind some criteria for selecting an interesting set of data to explore. We feel airbnb's listing data fits our search- - comprehensive data set with 94 original variables and over 30,000 observations for NYC area listings; - contains a rich set of variables, including a range of numerical and categorical variables; - the data is recently compiled in September,2015 by the author of insideairbnb.com; - the data contains interesting information on trends in properties and communities in the New York area.

### Project questions we wish to explore with statistical modeling techniques

Some questions or insights which we hope to address in this project include:

- Exploring the relationships between various predictors and Y variables price, or superhost status -- how strong are these relationships and do these appear to be linear or non-linear relationships?
- Building a classification model and identifying variables for predicting whether an airbnb host is likely to be classified as a superhost.
- Building a GAM model and identifying the best predictors for predicting the Y variable as price.


## Dataset

### Data Source

We used publicly available Airbnb listings data from http://insideairbnb.com/. We limited the scope of our analysis to New York City. The original dataset contained 94 information fields for 30,480 listings in the NYC area.

### Prep and Cleaning


```{r test-main, child='datacleaningtext.Rmd'}
```

## EDA

```{r, child='chris_eda.Rmd'}
```

```{r, child='maura_kmeans.Rmd'}
```

## Model Results and Diagnostics

###1)ManWhitneyWilcox test

```{r, child='chris_mann.Rmd'}
```


###2) Classification for predicting y:superhost and neighborhood

###3) ANOVA analysis

```{r, child='chris_anova.Rmd'}
```

###4) Lasso regression for predicting y:price

###5) Non-linear models: splines + GAM 

## Findings Summary: Comparing the models


## Conclusions

# Appendix

## R Code

### General Data Exploration

### Correlation of each Variable with Price



### Data Manipulation and Cleaning

## General Data Cleaning

# Variables Excluded

Because image and text analysis are out of scope for this project, the following variables in the original dataset were not considered for this analysis:

```{r}
drop.1 <- c("listing_url","summary","description"
,"notes","thumbnail_url","picture_url","host_url","host_thumbnail_url"
,"name","space","neighborhood_overview","transit","medium_url","xl_picture_url"
,"host_about","host_picture_url")

print(drop.1)
```

Some variables were excluded due to having little or no information in New York listings:

```{r}
drop.2 <- c("jurisdiction_names","requires_license",
            "experiences_offered" ,"square_feet","license")
print(drop.2)

```

Others were redundant or not relevant for this analysis.

```{r}
drop.3 <- c("scrape_id","host_location",
"neighbourhood","smart_location",
"country","weekly_price",
"calendar_last_scraped","availability_30",
"availability_365","last_review",
"city","zipcode",
"host_neighbourhood","last_scraped",
"street","market",
"country_code","calendar_updated",
"monthly_price","has_availability",
"availability_90","first_review",
"host_listings_count","state",
"host_name")

print(drop.3)
```


```{r test-main, child='datacleaningcode.Rmd'}
```

### EDA

```{r, child='chris_eda_code.Rmd'}
```

```{r, child='alimu_average_price_zipcode_code.Rmd'}
```

```{r, child='maura_kmeans_code.Rmd'}
```

### Models

```{r, child='chris_mann_code.Rmd'}
```

```{r, child='chris_anova_code.Rmd'}
```

```{r, child='lasso_christine.Rmd'}
```

## Tables

### Neighborhood Clusters

#### Number of listings by neighbohood and cluster

```{r, echo=FALSE, tidy=TRUE, warning=FALSE,message=FALSE}
kable(table(airbnb$neighbourhood_cleansed, gsub("cluster.", "", airbnb$neighborhood_cluster)))
```
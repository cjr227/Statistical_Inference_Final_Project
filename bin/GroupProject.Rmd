---
title: "Statistical Inference W4702 Final Project"
author: "Christopher Rusnak, Alimu Mijiti, Christine Lee, Maura Fitzgerald"
date: "December 15, 2015"
output: 
  pdf_document:
    toc: yes
---

```{r knitr_options, include=FALSE, warning=FALSE,message=FALSE}
package_list <- c("knitr","ggplot2","RTextTools",
                  "leaflet","maps","data.table",
                  "dplyr","reshape2",
                  "MASS","rpart","glmnet","gam","sp",
                  "rgdal","rgeos","ggthemes","maptools",
                  'mapproj', 'digest',"rlang","bindrcpp",
                  'glue','pkgconfig','tibble',"ggmap")
for(i in 1:length(package_list)){
  if(package_list[i]=="ggmap"){
    devtools::install_github("dkahle/ggmap")
  }
  else if(!(package_list[i] %in% installed.packages())){
    install.packages(package_list[i])
  } 
}

devtools::install_github("dkahle/ggmap")

library(knitr)
library(ggplot2)
library(RTextTools)
library(leaflet)
library(maps)
library(data.table)
library(dplyr)
library(ggmap)
library(reshape2)
library(MASS)
library(rpart)
library(glmnet)
library(gam)
library(sp)
library(rgdal)
library(rgeos)
library(ggthemes)
library(maptools)
opts_chunk$set(tidy.opts=list(width.cutoff=50))

set.seed(123)
```

## Introduction

```{r test-main, child='christine_intros.Rmd'}
```

## Dataset

### Data Source

We used publicly available Airbnb listings data from http://insideairbnb.com/. We limited the scope of our analysis to New York City. The original dataset contained 94 information fields for 30,480 listings in the NYC area.

### Prep and Cleaning


```{r test-main, child='datacleaningtext.Rmd'}
```

```{r test-main, child='datacleaningcode.Rmd'}
```

## EDA

```{r, child='chris_eda.Rmd'}
```

```{r, child='alimu_eda.Rmd'}
```

```{r, child='maura_kmeans.Rmd'}
```

## Model Results and Diagnostics

###1)ManWhitneyWilcox test

```{r, child='chris_mann.Rmd'}
```


###2) Classification for predicting y:superhost and neighborhood

###3) ANOVA analysis

```{r, child='chris_anova.Rmd'}
```

###4) Lasso regression for predicting y:price

###5) Non-linear models: splines + GAM 

## Findings Summary: Comparing the models


## Conclusions

# Appendix

## R Code

### General Data Exploration

#### Correlation of each Variable with Price



### Data Manipulation and Cleaning

#### General Data Cleaning

##### Variables Excluded

Because image and text analysis are out of scope for this project, the following variables in the original dataset were not considered for this analysis:

```{r, echo=FALSE}
drop.1 <- c("listing_url","summary","description"
,"notes","thumbnail_url","picture_url","host_url","host_thumbnail_url"
,"name","space","neighborhood_overview","transit","medium_url","xl_picture_url"
,"host_about","host_picture_url")

print(drop.1)
```

Some variables were excluded due to having little or no information in New York listings:

```{r, echo=FALSE}
drop.2 <- c("jurisdiction_names","requires_license",
            "experiences_offered" ,"square_feet","license")
print(drop.2)

```

Others were redundant or not relevant for this analysis.

```{r, echo=FALSE}
drop.3 <- c("scrape_id","host_location",
"neighbourhood","smart_location",
"country","weekly_price",
"calendar_last_scraped","availability_30",
"last_review",
"city",
"host_neighbourhood","last_scraped",
"street","market",
"country_code","calendar_updated",
"monthly_price","has_availability",
"availability_90","first_review",
"host_listings_count","state",
"host_name")

print(drop.3)
```


```{r test-main, child='datacleaningcode.Rmd', eval=FALSE}
```

### EDA

```{r, child='chris_eda_code.Rmd'}
```

```{r, child='alimu_average_price_zipcode_code.Rmd'}
```

```{r, child='maura_kmeans_code.Rmd'}
```

### Models

```{r, child='chris_mann_code.Rmd'}
```

```{r, child='alimu_LDA_code.Rmd'}
```

```{r, child='alimu_QDA_code.Rmd'}
```

```{r, child='alimu_tree_code.Rmd'}
```

```{r, child='chris_anova_code.Rmd'}
```

```{r, child='lasso_christine.Rmd'}
```

```{r, child='maura_gam_w_cv_code.Rmd'}
```

## Tables

### Neighborhood Clusters

#### Number of listings by neighbohood and cluster

```{r, echo=FALSE, tidy=TRUE, warning=FALSE,message=FALSE}
kable(table(airbnb$neighbourhood_cleansed, gsub("cluster.", "", airbnb$neighborhood_cluster)))
```